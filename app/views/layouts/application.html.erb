<!DOCTYPE html>
<html>
  <head>
    <title>OSuite</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag "application" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <% if current_user %>
      <nav class="main-nav">
        <%= link_to 'Dashboard', dashboard_path, class: 'nav-tab dashboard-tab' %>
        <%= link_to 'Notes', notes_path, class: 'nav-tab notes-tab' %>
        <%= link_to 'Tasks', tasks_path, class: 'nav-tab tasks-tab' %>
        <%= link_to 'Wiki', wiki_pages_path, class: 'nav-tab wiki-tab' %>
        <%= link_to 'SimpleBase', simplebase_tables_path, class: 'nav-tab simplebase-tab' %>
        <%= link_to 'Chat', chat_messages_path, class: 'nav-tab chat-tab' %>
        <% if current_user.admin? %>
          <%= link_to 'Users', users_path, class: 'nav-tab users-tab' %>
        <% end %>
        <div class="nav-right">
          <span class="user-info">
            Logged in as: <%= current_user.name %>
            <%= '(Admin)' if current_user.admin? %>
          </span>
          <%= button_to 'Logout', logout_path, method: :delete, class: 'nav-tab logout-tab' %>
        </div>
      </nav>

      <style>
        .main-nav {
          background: #f8f9fa;
          padding: 1rem;
          display: flex;
          align-items: center;
          gap: 1rem;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-right {
          margin-left: auto;
          display: flex;
          align-items: center;
          gap: 1rem;
        }

        .user-info {
          color: #666;
          font-size: 0.9rem;
        }

        .nav-tab {
          padding: 0.75rem 1.5rem;
          border-radius: 8px;
          text-decoration: none;
          color: white;
          font-weight: 500;
          transition: all 0.2s;
        }

        .nav-tab:hover {
          transform: translateY(-1px);
          filter: brightness(110%);
        }

        .dashboard-tab { background-color: #4a90e2; }
        .notes-tab { background-color: #67c23a; }
        .tasks-tab { background-color: #e6a23c; }
        .wiki-tab { background-color: #f56c6c; }
        .simplebase-tab { background-color: #909399; }
        .chat-tab { background-color: #9c27b0; }
        .users-tab { background-color: #3f51b5; }
        .logout-tab { 
          background-color: #dc3545;
          border: none;
          cursor: pointer;
        }
      </style>
    <% end %>
    
    <main>
      <% if flash[:notice] %>
        <div class="alert notice"><%= flash[:notice] %></div>
      <% end %>
      <% if flash[:alert] %>
        <div class="alert error"><%= flash[:alert] %></div>
      <% end %>
      
      <%= yield %>
    </main>
  </body>
</html>
